version: '3'
services:

  db-sql-server:
    container_name: mobydq-test-db-sql-server
    image: mobydq-test-db-sql-server
    restart: always
    build:
      context: .
      dockerfile: ./db-sql-server/Dockerfile
    environment:
      ACCEPT_EULA: "Y"
      SA_PASSWORD: "1234-abcd"
    command: ["/bin/bash", "entrypoint.sh"]
    ports:
      - 9000:1433
    networks:
      - default

  db-mysql:
    container_name: mobydq-test-db-mysql
    image: mobydq-test-db-mysql
    restart: always
    build:
      context: .
      dockerfile: ./db-mysql/Dockerfile
    environment:
      MYSQL_ROOT_PASSWORD: "1234"
    ports:
      - 9001:3306
    networks:
      - default

  db-postgresql:
    container_name: mobydq-test-db-postgresql
    image: mobydq-test-db-postgresql
    restart: always
    build:
      context: .
      dockerfile: ./db-postgresql/Dockerfile
    environment:
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "1234"
      POSTGRES_DATABASE: "star_wars"
    ports:
      - 9002:5432
    networks:
      - default

  test:
    container_name: data-quality-test
    image: data-quality-test
    build:
      context: .
      dockerfile: ./Dockerfile
    command: ["nose2", "-v"]
    depends_on:
      - db-sql-server
      - db-mysql
      - db-postgresql
    links:
      - db-sql-server
      - db-mysql
      - db-postgresql
    networks:
      - default

networks:
  default:
    external:
      name: data-quality-network
